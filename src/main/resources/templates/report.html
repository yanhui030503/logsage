<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title th:text="'报告 - ' + ${analysis.title}">报告详情 - LogSage</title>
	<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
	<div class="container">
		<div class="nav">
			<span>LogSage</span>
			<div>
				<a th:href="@{/analyze}">分析</a>
				<a th:href="@{/history}">历史</a>
				<a th:href="@{/settings}">设置</a>
				<a th:href="@{/logout}">退出</a>
			</div>
		</div>

		<h1 th:text="${analysis.title}">报告标题</h1>
		<div class="history-meta">
			<span th:text="${analysis.logType}">类型</span> | 
			<span th:text="${#temporals.format(analysis.createdAt, 'yyyy-MM-dd HH:mm:ss')}">时间</span>
		</div>

		<div class="analysis-result">
			<div th:if="${analysis.tldr}">
				<h3>TL;DR</h3>
				<p th:text="${analysis.tldr}"></p>
			</div>

			<div th:if="${analysis.topCauses}">
				<h3>Top 3 可能原因</h3>
				<div th:each="cause : ${analysis.topCauses}" class="cause-item">
					<strong th:text="${cause.cause}">原因</strong>
					<span class="confidence" th:text="'置信度: ' + ${#numbers.formatDecimal(cause.confidence, 0, 2)}">置信度</span>
					<p style="margin-top: 5px;" th:text="${cause.evidence}">证据</p>
				</div>
			</div>

			<div th:if="${analysis.verificationSteps}">
				<h3>最短验证步骤</h3>
				<div th:each="step : ${analysis.verificationSteps}" class="step-item">
					<strong th:text="${step.step}">步骤</strong>
					<p style="margin-top: 5px;" th:text="${step.why}">原因</p>
					<code style="display: block; margin-top: 5px; padding: 5px; background: #f0f0f0; border-radius: 3px;" 
						th:text="${step.command}">命令</code>
				</div>
			</div>

			<div th:if="${analysis.suggestedFixes}">
				<h3>建议修复</h3>
				<div th:each="fix : ${analysis.suggestedFixes}" class="fix-item">
					<p th:text="${fix.fix}">修复建议</p>
					<span class="risk" 
						th:classappend="'risk-' + ${fix.risk.toLowerCase()}" 
						th:text="'风险: ' + ${fix.risk}">风险</span>
				</div>
			</div>

			<div th:if="${analysis.needMoreInfo}">
				<h3>需要更多信息</h3>
				<p th:text="${analysis.needMoreInfo}"></p>
			</div>
		</div>

		<div style="margin-top: 20px;">
			<button onclick="copyReport()" class="btn copy-btn">复制报告内容</button>
			<a th:href="@{/history}" class="btn btn-secondary">返回历史</a>
		</div>
	</div>

	<script>
		function copyReport() {
			const reportContent = document.querySelector('.analysis-result').innerText;
			navigator.clipboard.writeText(reportContent).then(function() {
				alert('报告内容已复制到剪贴板');
			}, function() {
				alert('复制失败，请手动选择文本复制');
			});
		}
	</script>
</body>
</html>
